{"version":3,"file":"index.js","sources":["../src/index.ts"],"sourcesContent":["import parser from 'postcss-value-parser'\nimport { EasingFunctions, EasingFunctionKeys, CSSSpringEasing, registerEasingFunctions, toFixed } from 'spring-easing'\n\nimport type { FunctionNode } from 'postcss-value-parser'\nimport type { TypeCSSEasingOptions, TypeFrameFunction } from 'spring-easing'\nimport type { PluginCreator } from 'postcss'\n\nexport function toSnake(str: string) {\n  return str[0] + str.slice(1).replace(/[A-Z]/g, letter => {\n    return '-' + letter.toLowerCase()\n  })\n}\n\nexport function toCamel(str: string) {\n  return str.replace(/-[a-z]/g, letter => {\n    return letter[1].toUpperCase()\n  })\n}\n\nconst easingFns: Record<string, TypeFrameFunction> = {}\nfor (let name of EasingFunctionKeys) {\n  easingFns[name.replace(/-/g, \"\").toLowerCase()] = EasingFunctions[name]\n  easingFns[toSnake(name)] = EasingFunctions[name]\n}\n\nregisterEasingFunctions(easingFns);\n\nexport type PluginOpts = Omit<TypeCSSEasingOptions, \"easing\"> & { easings?: Record<string, TypeFrameFunction> };\nexport const springEasingPlugin: PluginCreator<PluginOpts> = function (opts = {}) {\n  const { easings, ...easingOpts } = opts;\n  const locals: Record<string, TypeFrameFunction> = Object.assign({}, EasingFunctions)\n  if (opts.easings) {\n    for (let name in Object.assign({}, opts.easings)) {\n      locals[name.replace(/-/g, \"\").toLowerCase()] = opts.easings[name]\n      locals[toSnake(name)] = opts.easings[name]\n    }\n  }\n\n  registerEasingFunctions(locals);\n\n  const localKeys = Array.from(new Set(Object.keys(locals)))\n  const localKeysStr = localKeys.join(\"|\").trim();\n\n  return {\n    postcssPlugin: 'postcss-spring-easing',\n    Declaration(decl) {\n      if (!new RegExp(localKeysStr, 'i').test(decl.value)) return\n      let root = parser(decl.value)\n      let changed = false\n      root.nodes = root.nodes.map(node => {\n        let value = node.value.trim()\n        const isFunction = node.type === 'function';\n        const isWord = node.type === 'word';\n        if ((isWord || isFunction) && value.length > 0 && new RegExp(`^(${localKeysStr})$`, 'i').test(value)) {\n          changed = true\n          const contents = isFunction ? parser.stringify(node) : value;\n          const [easings, duration] = CSSSpringEasing({\n            easing: contents,\n            ...easingOpts\n          });\n          node.type = \"function\";\n          node.value = `linear`;\n          (node as FunctionNode).nodes = parser(easings).nodes;\n          decl.before(`--spring-duration: ${toFixed(duration, 2)}ms;`)\n        }\n        return node\n      })\n      if (changed) {\n        decl.value = root.toString()\n      }\n    }\n  }\n}\nexport const postcss = true;\nspringEasingPlugin.postcss = postcss;\nexport default springEasingPlugin;"],"names":["EasingFunctionKeys","EasingFunctions","registerEasingFunctions","easings","CSSSpringEasing","toFixed"],"mappings":";;;;AAOO,WAAS,QAAQ,KAAa;AAC5B,WAAA,IAAI,CAAC,IAAI,IAAI,MAAM,CAAC,EAAE,QAAQ,UAAU,CAAU,WAAA;AAChD,aAAA,MAAM,OAAO;IAAY,CACjC;AAAA,EACH;AAEO,WAAS,QAAQ,KAAa;AAC5B,WAAA,IAAI,QAAQ,WAAW,CAAU,WAAA;AAC/B,aAAA,OAAO,CAAC,EAAE;IAAY,CAC9B;AAAA,EACH;AAEA,QAAM,YAA+C,CAAA;AACrD,WAAS,QAAQA,aAAAA,oBAAoB;AACzB,cAAA,KAAK,QAAQ,MAAM,EAAE,EAAE,aAAa,IAAIC,6BAAgB,IAAI;AACtE,cAAU,QAAQ,IAAI,CAAC,IAAIA,6BAAgB,IAAI;AAAA,EACjD;AAEA,eAAA,wBAAwB,SAAS;AAG1B,QAAM,qBAAgD,SAAU,OAAO,IAAI;AAChF,UAAM,EAAE,SAAS,GAAG,WAAA,IAAe;AACnC,UAAM,SAA4C,OAAO,OAAO,IAAIA,aAAe,eAAA;AACnF,QAAI,KAAK,SAAS;AAChB,eAAS,QAAQ,OAAO,OAAO,CAAA,GAAI,KAAK,OAAO,GAAG;AACzC,eAAA,KAAK,QAAQ,MAAM,EAAE,EAAE,aAAa,IAAI,KAAK,QAAQ,IAAI;AAChE,eAAO,QAAQ,IAAI,CAAC,IAAI,KAAK,QAAQ,IAAI;AAAA,MAC3C;AAAA,IACF;AAEAC,iBAAA,wBAAwB,MAAM;AAExB,UAAA,YAAY,MAAM,KAAK,IAAI,IAAI,OAAO,KAAK,MAAM,CAAC,CAAC;AACzD,UAAM,eAAe,UAAU,KAAK,GAAG,EAAE,KAAK;AAEvC,WAAA;AAAA,MACL,eAAe;AAAA,MACf,YAAY,MAAM;AACZ,YAAA,CAAC,IAAI,OAAO,cAAc,GAAG,EAAE,KAAK,KAAK,KAAK;AAAG;AACjD,YAAA,OAAO,OAAO,KAAK,KAAK;AAC5B,YAAI,UAAU;AACd,aAAK,QAAQ,KAAK,MAAM,IAAI,CAAQ,SAAA;AAC9B,cAAA,QAAQ,KAAK,MAAM,KAAK;AACtB,gBAAA,aAAa,KAAK,SAAS;AAC3B,gBAAA,SAAS,KAAK,SAAS;AAC7B,eAAK,UAAU,eAAe,MAAM,SAAS,KAAK,IAAI,OAAO,KAAK,kBAAkB,GAAG,EAAE,KAAK,KAAK,GAAG;AAC1F,sBAAA;AACV,kBAAM,WAAW,aAAa,OAAO,UAAU,IAAI,IAAI;AACvD,kBAAM,CAACC,UAAS,QAAQ,IAAIC,6BAAgB;AAAA,cAC1C,QAAQ;AAAA,cACR,GAAG;AAAA,YAAA,CACJ;AACD,iBAAK,OAAO;AACZ,iBAAK,QAAQ;AACZ,iBAAsB,QAAQ,OAAOD,QAAO,EAAE;AAC/C,iBAAK,OAAO,sBAAsBE,aAAAA,QAAQ,UAAU,CAAC,MAAM;AAAA,UAC7D;AACO,iBAAA;AAAA,QAAA,CACR;AACD,YAAI,SAAS;AACN,eAAA,QAAQ,KAAK;QACpB;AAAA,MACF;AAAA,IAAA;AAAA,EAEJ;AACa,QAAA,UAAU;AACvB,qBAAmB,UAAU;;;;;;;;"}